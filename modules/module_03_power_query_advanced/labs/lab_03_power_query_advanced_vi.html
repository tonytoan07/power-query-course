<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab 3: Power Query Nâng cao - Khóa học Tự động hóa Dữ liệu Excel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #24292f;
            background-color: #ffffff;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 16px;
        }

        .header {
            background: linear-gradient(135deg, #0078d4 0%, #106ebe 100%);
            color: white;
            padding: 1.5rem 0;
            margin-bottom: 2rem;
        }

        .breadcrumb {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }

        .breadcrumb a {
            color: white;
            text-decoration: none;
        }

        h1 {
            margin: 0;
            font-size: 2rem;
            font-weight: 600;
        }

        h2 {
            color: #0969da;
            border-bottom: 2px solid #d1d9e0;
            padding-bottom: 0.5rem;
            margin-top: 2rem;
        }

        h3 {
            color: #24292f;
            margin-top: 1.5rem;
        }

        .lab-info {
            background: #f6f8fa;
            border-left: 4px solid #0969da;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 6px 6px 0;
        }

        .step-box {
            background: white;
            border: 1px solid #d1d9e0;
            border-radius: 6px;
            padding: 1.5rem;
            margin: 1rem 0;
        }

        .step-number {
            background: #0969da;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 600;
            margin-right: 0.5rem;
        }

        code {
            background: #f6f8fa;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            font-size: 0.9em;
        }

        pre {
            background: #f6f8fa;
            padding: 1rem;
            border-radius: 6px;
            overflow-x: auto;
            border: 1px solid #d1d9e0;
        }

        .alert {
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
        }

        .alert-info {
            background: #e6f3ff;
            border: 1px solid #0969da;
            color: #0969da;
        }

        ul, ol {
            padding-left: 2rem;
        }

        li {
            margin: 0.5rem 0;
        }

        .lab-image {
            max-width: 700px;
            width: 100%;
            height: auto;
            border: 1px solid #d1d9e0;
            border-radius: 6px;
            margin: 1rem 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .lab-figure {
            margin: 1.5rem 0;
            text-align: center;
        }

        .image-caption {
            font-size: 0.9rem;
            color: #656d76;
            text-align: center;
            margin-top: 0.5rem;
            font-style: italic;
        }

        .deliverables {
            background: #e6f3ff;
            border: 1px solid #0969da;
            border-radius: 6px;
            padding: 1rem;
            margin: 2rem 0;
        }

        .language-switcher {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }

        .lang-btn {
            padding: 8px 12px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .lang-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .lang-btn.active {
            background: rgba(255, 255, 255, 0.9);
            color: #0969da;
            border-color: white;
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin: 3rem 0;
            padding-top: 2rem;
            border-top: 1px solid #d1d9e0;
        }
    </style>
</head>

<body>
    <div class="header">
        <div class="language-switcher">
            <a href="lab_03_power_query_advanced.html" class="lang-btn">EN</a>
            <a href="lab_03_power_query_advanced_vi.html" class="lang-btn active">VI</a>
        </div>
        <div class="container">
            <div class="breadcrumb">
                <a href="../../../index.html">Trang chủ Khóa học</a> >
                Module 3 >
                Lab 3
            </div>
            <h1>Lab 3: Chuyển đổi Power Query Nâng cao</h1>
            <p>Dimension, Chất lượng Dữ liệu và Chuẩn hóa Tiền tệ</p>
        </div>
    </div>

    <div class="container">
        <div class="lab-info">
            <h3>Tổng quan Lab</h3>
            <p>Trong lab toàn diện này, bạn sẽ thành thạo các kỹ thuật Power Query nâng cao để tạo dimension table, xác thực chất lượng dữ liệu và chuẩn hóa tiền tệ cho dashboard ngân hàng chuyên nghiệp.</p>

            <h4>Mục tiêu Lab</h4>
            <ul>
                <li>Tạo dimension table cho việc lọc dashboard</li>
                <li>Thêm dimension ngày cho phân tích kỳ</li>
                <li>Xác thực chất lượng dữ liệu với tuân thủ ngân hàng</li>
                <li>Tối ưu hóa cấu trúc dữ liệu cho hiệu suất dashboard</li>
                <li>Chuẩn bị dữ liệu sạch cho mối quan hệ data model</li>
            </ul>
        </div>

        <h2>Exercise 1: Thêm Date Dimension</h2>

        <div class="step-box">
            <h3><span class="step-number">1</span>Tạo Bảng Date Dimension</h3>
            <ol>
                <li>Trong Power Query Editor, <strong>right-click</strong> trên query <strong>Transactions</strong></li>
                <li>Chọn <strong>"Reference"</strong></li>
                <li>Đổi tên query mới thành <strong>"Time_Periods"</strong></li>
                <li>Chỉ chọn cột <strong>Date</strong></li>
                <li>Right-click → <strong>"Remove Other Columns"</strong></li>
                <li>Đi đến <strong>Transform</strong> → <strong>Remove Duplicates</strong> (chỉ lấy ngày duy nhất)</li>
            </ol>

            <div class="lab-figure">
                <img src="images/module 3 - excercise 1 - 1.1.png" alt="Reference query" class="lab-image">
                <p class="image-caption">Tạo reference query từ Transactions</p>
            </div>

            <div class="lab-figure">
                <img src="images/module 3 - excercise 1 - 1.2.png" alt="Remove other columns" class="lab-image">
                <p class="image-caption">Chỉ giữ cột Date</p>
            </div>

            <div class="lab-figure">
                <img src="images/module 3 - excercise 1 - 1.3.png" alt="Remove duplicates" class="lab-image">
                <p class="image-caption">Loại bỏ ngày trùng lặp</p>
            </div>
        </div>

        <div class="step-box">
            <h3><span class="step-number">2</span>Thêm Cột Date Dimension</h3>
            <ol>
                <li>Trong query Time_Periods, chọn cột <strong>Date</strong></li>
                <li><strong>Add Column</strong> → <strong>Date</strong> → <strong>Year</strong></li>
                <li><strong>Add Column</strong> → <strong>Date</strong> → <strong>Quarter</strong> → <strong>Quarter of Year</strong></li>
                <li><strong>Add Column</strong> → <strong>Date</strong> → <strong>Month</strong> → <strong>Name of Month</strong></li>
                <li>Đổi tên cột:
                    <ul>
                        <li>"Year" → "Calendar_Year"</li>
                        <li>"Quarter" → "Calendar_Quarter"</li>
                        <li>"Month Name" → "Month_Name"</li>
                    </ul>
                </li>
            </ol>

            <div class="lab-figure">
                <img src="images/module 3 - excercise 1 - 2.png" alt="Add date columns" class="lab-image">
                <p class="image-caption">Thêm cột Year, Quarter và Month</p>
            </div>
        </div>

        <div class="step-box">
            <h3><span class="step-number">3</span>Tạo Period Label</h3>
            <ol>
                <li><strong>Add Column</strong> → <strong>Custom Column</strong></li>
                <li>Column Name: "Period_Label"</li>
                <li>Formula: <code>"Q" & Text.From([Calendar_Quarter]) & " " & Text.From([Calendar_Year])</code></li>
                <li>Thêm cột khác: "Year_Month"</li>
                <li>Formula: <code>Text.From([Calendar_Year]) & "-" & Text.PadStart(Text.From(Date.Month([Date])), 2, "0")</code></li>
                <li>Kết quả: "Q1 2024", "2024-01", v.v.</li>
            </ol>

            <div class="lab-figure">
                <img src="images/module 3 - excercise 1 - 3.1.png" alt="Period label formula" class="lab-image">
                <p class="image-caption">Tạo custom column Period_Label</p>
            </div>

            <div class="lab-figure">
                <img src="images/module 3 - excercise 1 - 3.2.png" alt="Period label result" class="lab-image">
                <p class="image-caption">Kết quả với cột Period_Label và Year_Month</p>
            </div>

            <div class="alert alert-info">
                <strong>Tại sao cần Date dimension riêng biệt?</strong> Điều này tạo bảng ngày có thể tái sử dụng cho nhiều fact table và cho phép lọc theo thời gian phù hợp trong dashboard.
            </div>
        </div>

        <div class="step-box">
            <h3><span class="step-number">4</span>Tạo Account Hierarchy Dimension</h3>
            <ol>
                <li>Trong Power Query Editor, đi đến <strong>Home</strong> → <strong>New Source</strong> → <strong>Text/CSV</strong></li>
                <li>Chọn <strong>account_hierarchy.csv</strong> từ thư mục raw data</li>
                <li>Đổi tên query thành <strong>"Account_Hierarchy"</strong></li>
                <li>Xác minh cột: Level_1, Level_2, Level_3, Account_Code</li>
                <li>Thay đổi kiểu dữ liệu Account_Code thành <strong>Text</strong></li>
                <li><strong>Add Column</strong> → <strong>Custom Column</strong></li>
                <li>Column Name: <strong>"Account_Code_Standard"</strong></li>
                <li>Formula: <code>Text.PadStart([Account_Code], 6, "0")</code></li>
                <li>Điều này tạo mã tài khoản 6 chữ số có padding (1110 → 001110) để merge chuẩn</li>
                <li>Điều này cho phép nhóm tài khoản trong dashboard (Tài sản, Nợ phải trả, Vốn chủ sở hữu)</li>
            </ol>

            <div class="lab-figure">
                <img src="images/module 3 - excercise 1 - 4.png" alt="Account hierarchy" class="lab-image">
                <p class="image-caption">Import và cấu hình dimension Account_Hierarchy</p>
            </div>
        </div>

        <div class="step-box">
            <h3><span class="step-number">5</span>Tạo Exchange Rates Dimension</h3>
            <ol>
                <li><strong>New Source</strong> → <strong>Text/CSV</strong></li>
                <li>Chọn <strong>exchange_rates.csv</strong> từ thư mục raw data</li>
                <li>Nhấp <strong>Transform Data</strong></li>
                <li>Đổi tên query thành <strong>"Exchange_Rates"</strong></li>
                <li>Xác minh cột: <strong>Currency</strong> (Text), <strong>Rate</strong> (Decimal Number)</li>
                <li>Thay đổi kiểu dữ liệu <strong>Rate</strong> thành <strong>Decimal Number</strong> nếu cần</li>
            </ol>

            <div class="lab-figure">
                <img src="images/module 3 - excercise 1 - 5.png" alt="Exchange rates" class="lab-image">
                <p class="image-caption">Import bảng dimension Exchange_Rates</p>
            </div>

            <div class="alert alert-info">
                <strong>Tác động Dashboard:</strong> Tỷ giá hối đoái cho phép chuyển đổi tiền tệ động trong dashboard (VND ↔ USD ↔ EUR).
            </div>
        </div>

        <h2>Exercise 2: Xác thực Chất lượng Dữ liệu</h2>

        <div class="step-box">
            <h3><span class="step-number">1</span>Xác thực Mã Tài khoản</h3>
            <ol>
                <li><strong>Trong query Transactions, Add Column</strong> → <strong>Custom Column</strong></li>
                <li>Column Name: "Account_Validation"</li>
                <li>Formula: <code>if [Account_Name] = null then "WARNING: Invalid Account Code" else "Valid"</code></li>
                <li>Điều này sử dụng kết quả merge từ Module 2 - Account_Name null có nghĩa là AccountCode không hợp lệ</li>
                <li>Điều này đánh dấu giao dịch với mã tài khoản không hợp lệ</li>
            </ol>

            <div class="lab-figure">
                <img src="images/module 3 - excercise 2 - 1.png" alt="Account validation" class="lab-image">
                <p class="image-caption">Tạo cột Account_Validation</p>
            </div>
        </div>

        <div class="step-box">
            <h3><span class="step-number">2</span>Tạo Cờ Chất lượng Dữ liệu Tổng thể</h3>
            <ol>
                <li><strong>Add Column</strong> → <strong>Custom Column</strong></li>
                <li>Column Name: "Data_Quality_Status"</li>
                <li>Formula: <code>if [Account_Validation] = "Valid" then "CLEAN" else "REVIEW_REQUIRED"</code></li>
                <li>Điều này cung cấp đánh giá chất lượng dữ liệu tổng thể</li>
            </ol>

            <div class="lab-figure">
                <img src="images/module 3 - excercise 2 - 2.png" alt="Data quality flag" class="lab-image">
                <p class="image-caption">Tạo cột Data_Quality_Status</p>
            </div>
        </div>

        <div class="step-box">
            <h3><span class="step-number">3</span>Kiểm tra Tuân thủ Ngân hàng</h3>
            <ol>
                <li><strong>Add Column</strong> → <strong>Custom Column</strong></li>
                <li>Column Name: "Audit_Flag"</li>
                <li>Formula: <code>if [Data_Quality_Status] = "REVIEW_REQUIRED" then "AUDIT: Data Quality Issue - " & [TransactionID] else "OK"</code></li>
                <li>Điều này tạo audit trail để tuân thủ</li>
            </ol>

            <div class="lab-figure">
                <img src="images/module 3 - excercise 2 - 3.png" alt="Audit flag" class="lab-image">
                <p class="image-caption">Tạo Audit_Flag để theo dõi tuân thủ</p>
            </div>
        </div>

        <h2>Exercise 3: Chuẩn hóa Tiền tệ</h2>

        <div class="step-box">
            <h3><span class="step-number">1</span>Merge Exchange Rates với Transactions</h3>
            <ol>
                <li>Trong query <strong>Transactions</strong>, đi đến <strong>Home</strong> → <strong>Merge Queries</strong></li>
                <li>Chọn cột <strong>Currency</strong> từ Transactions</li>
                <li>Chọn <strong>Exchange_Rates</strong> làm bảng thứ hai</li>
                <li>Chọn cột <strong>Currency</strong> từ Exchange_Rates</li>
                <li>Join Kind: <strong>Left Outer</strong> (để giữ tất cả giao dịch)</li>
                <li>Nhấp <strong>OK</strong></li>
            </ol>

            <div class="lab-figure">
                <img src="images/module 3 - excercise 3 - 1.png" alt="Merge exchange rates" class="lab-image">
                <p class="image-caption">Merge Exchange_Rates với Transactions</p>
            </div>
        </div>

        <div class="step-box">
            <h3><span class="step-number">2</span>Expand Dữ liệu Exchange Rate</h3>
            <ol>
                <li>Nhấp nút expand trên cột <strong>Exchange_Rates</strong></li>
                <li>Chỉ chọn cột <strong>Rate</strong></li>
                <li>Bỏ chọn "Use original column name as prefix"</li>
                <li>Đổi tên cột mới thành <strong>"Exchange_Rate"</strong></li>
            </ol>

            <div class="lab-figure">
                <img src="images/module 3 - excercise 3 - 2.png" alt="Expand rate column" class="lab-image">
                <p class="image-caption">Expand cột Rate từ bảng đã merge</p>
            </div>
        </div>

        <div class="step-box">
            <h3><span class="step-number">3</span>Tạo Cột Amount_VND</h3>
            <ol>
                <li><strong>Add Column</strong> → <strong>Custom Column</strong></li>
                <li>Column Name: <strong>"Amount_VND"</strong></li>
                <li>Formula: <code>if [Currency] = "VND" then [Amount] else [Amount] * [Exchange_Rate]</code></li>
                <li>Điều này chuyển đổi số tiền USD và EUR sang VND sử dụng tỷ giá</li>
                <li>Số tiền VND giữ nguyên (Rate = 1 cho VND)</li>
            </ol>

            <div class="lab-figure">
                <img src="images/module 3 - excercise 3 - 3.png" alt="Amount VND formula" class="lab-image">
                <p class="image-caption">Tạo cột Amount_VND để chuẩn hóa tiền tệ</p>
            </div>

            <div class="alert alert-info">
                <strong>Logic Tiền tệ:</strong> Tất cả số tiền được chuẩn hóa sang VND làm tiền tệ cơ sở. Dashboard sau đó sẽ chuyển đổi VND sang tiền tệ hiển thị một cách động.
            </div>
        </div>

        <div class="step-box">
            <h3><span class="step-number">4</span>Xác thực Chuyển đổi Tiền tệ</h3>
            <ol>
                <li>Thêm cột tạm thời để kiểm tra chuyển đổi:</li>
                <li><strong>Add Column</strong> → <strong>Custom Column</strong></li>
                <li>Column Name: <strong>"Conversion_Check"</strong></li>
                <li>Formula: <code>[Currency] & ": " & Text.From([Amount]) & " → " & Text.From([Amount_VND])</code></li>
                <li>Xem lại một vài dòng để xác minh chuyển đổi trông chính xác</li>
                <li>Xóa cột <strong>Conversion_Check</strong> sau khi xác thực</li>
            </ol>
        </div>

        <h2>Exercise 4: Tối ưu hóa Dữ liệu</h2>

        <div class="step-box">
            <h3><span class="step-number">1</span>Chọn Cột Cần thiết</h3>
            <ol>
                <li>Giữ <strong>Ctrl</strong> và chọn các cột này:
                    <ul>
                        <li>TransactionID, Date, Account_Code_Standard, TransactionType</li>
                        <li>Currency, Amount, Branch, CustomerID</li>
                        <li>Data_Quality_Status, Audit_Flag</li>
                    </ul>
                </li>
                <li>Right-click → <strong>Remove Other Columns</strong></li>
            </ol>
        </div>

        <div class="step-box">
            <h3><span class="step-number">2</span>Xác thực Cuối cùng</h3>
            <ol>
                <li><strong>Lọc Data_Quality_Status</strong> để hiển thị cả "CLEAN" và "REVIEW_REQUIRED"</li>
                <li>Giữ tất cả dữ liệu cho mục đích audit trail</li>
                <li><strong>Close & Load</strong> để cập nhật data model</li>
            </ol>

            <div class="lab-figure">
                <img src="images/module 3 - excercise 4 - 2.png" alt="Final validation" class="lab-image">
                <p class="image-caption">Xác thực dữ liệu cuối cùng và Close & Load</p>
            </div>
        </div>

        <div class="deliverables">
            <h3>Kết quả Lab</h3>

            <h4>✅ Query Time_Periods</h4>
            <ul>
                <li>Bảng ngày riêng biệt được reference từ Transactions</li>
                <li>Cột Calendar_Year, Calendar_Quarter, Month_Name</li>
                <li>Định dạng Period_Label (Q1 2024) và Year_Month (2024-01)</li>
            </ul>

            <h4>✅ Query Account_Hierarchy</h4>
            <ul>
                <li>Nhóm Level_1 (Tài sản, Nợ phải trả, Vốn chủ sở hữu), Level_2, Level_3</li>
                <li>Account_Code_Standard với padding 6 chữ số (1110 → 001110)</li>
                <li>Cho phép phân loại báo cáo tài chính phù hợp</li>
            </ul>

            <h4>✅ Query Exchange_Rates</h4>
            <ul>
                <li>Cột Currency và Rate để chuyển đổi đa tiền tệ</li>
                <li>Cho phép báo cáo USD nhất quán trong dashboard</li>
            </ul>

            <h4>✅ Dữ liệu Giao dịch Nâng cao</h4>
            <ul>
                <li>Cột Amount_VND được chuẩn hóa tiền tệ</li>
                <li>Xác thực chất lượng dữ liệu với cờ tuân thủ ngân hàng</li>
                <li>Audit trail hoàn chỉnh cho tất cả chuyển đổi</li>
                <li>Cấu trúc tối ưu hóa cho hiệu suất dashboard</li>
            </ul>
        </div>

        <h2>Bước tiếp theo</h2>
        <p>Trong Module 4, bạn sẽ học:</p>
        <ul>
            <li>Thiết kế data model với mối quan hệ bảng</li>
            <li>Tạo measure DAX cho tính toán tài chính</li>
            <li>Xây dựng chỉ số ngân hàng chuyên nghiệp</li>
            <li>Chuẩn bị nền tảng cho dashboard tương tác</li>
        </ul>

        <div class="nav-buttons">
            <a href="../../module_02_power_query_basics/labs/lab_02_power_query_basics_vi.html" class="btn btn-secondary">← Trước: Module 2</a>
            <a href="../../module_04_data_model_dax/labs/lab_04_data_model_dax_vi.html" class="btn btn-primary">Tiếp: Module 4 →</a>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
</body>

</html>
