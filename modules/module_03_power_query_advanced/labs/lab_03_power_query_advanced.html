<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab 3: Essential Power Query Transformations - Excel Data Automation Training</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #24292f;
            background-color: #ffffff;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 16px;
        }

        .header {
            background: linear-gradient(135deg, #0078d4 0%, #106ebe 100%);
            color: white;
            padding: 1.5rem 0;
            margin-bottom: 2rem;
        }

        .breadcrumb {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }

        .breadcrumb a {
            color: white;
            text-decoration: none;
        }

        h1 {
            margin: 0;
            font-size: 2rem;
            font-weight: 600;
        }

        h2 {
            color: #0969da;
            border-bottom: 2px solid #d1d9e0;
            padding-bottom: 0.5rem;
            margin-top: 2rem;
        }

        h3 {
            color: #24292f;
            margin-top: 1.5rem;
        }

        .lab-info {
            background: #f6f8fa;
            border-left: 4px solid #0969da;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 6px 6px 0;
        }

        .step-box {
            background: white;
            border: 1px solid #d1d9e0;
            border-radius: 6px;
            padding: 1.5rem;
            margin: 1rem 0;
        }

        .step-number {
            background: #0969da;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 600;
            margin-right: 0.5rem;
        }

        code {
            background: #f6f8fa;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            font-size: 0.9em;
        }

        pre {
            background: #f6f8fa;
            padding: 1rem;
            border-radius: 6px;
            overflow-x: auto;
            border: 1px solid #d1d9e0;
        }

        .alert {
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
        }

        .alert-info {
            background: #e6f3ff;
            border: 1px solid #0969da;
            color: #0969da;
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin: 3rem 0;
            padding-top: 2rem;
            border-top: 1px solid #d1d9e0;
        }

        .nav-button {
            padding: 0.75rem 1.5rem;
            background: #0969da;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 500;
        }

        .nav-button:hover {
            background: #0860ca;
        }

        .lab-image {
            max-width: 700px;
            width: 100%;
            height: auto;
            border: 1px solid #d1d9e0;
            border-radius: 6px;
            margin: 1rem 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .lab-figure {
            margin: 1.5rem 0;
            text-align: center;
        }

        .image-caption {
            font-size: 0.9rem;
            color: #656d76;
            text-align: center;
            margin-top: 0.5rem;
            font-style: italic;
        }

        .deliverables {
            background: #e6f3ff;
            border: 1px solid #0969da;
            border-radius: 6px;
            padding: 1rem;
            margin: 2rem 0;
        }

        .language-switcher {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }

        .lang-btn {
            padding: 8px 12px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .lang-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .lang-btn.active {
            background: rgba(255, 255, 255, 0.9);
            color: #0969da;
            border-color: white;
        }
    </style>
</head>

<body>
    <div class="header">
        <div class="language-switcher">
            <a href="lab_03_power_query_advanced.html" class="lang-btn active">EN</a>
            <a href="lab_03_power_query_advanced_vi.html" class="lang-btn">VI</a>
        </div>
        <div class="container">
            <div class="breadcrumb">
                <a href="../../../index.html">Training Home</a> >
                Module 3 >
                Lab 3
            </div>
            <h1>Lab 3: Data Preparation for Dashboard</h1>
            <p>Essential Data Enhancement for Banking Dashboard</p>
        </div>
    </div>

    <div class="container">
        <div class="lab-info">
            <h3>Lab Overview</h3>
            <p>In this focused lab, you'll prepare your transaction data for dashboard creation by adding essential date
                dimensions, validating data quality, and optimizing the dataset for the data model.</p>

            <h4>Prerequisites</h4>
            <ul>
                <li>Completed Lab 2 (imported transaction data)</li>
                <li>Transaction data and chart of accounts loaded</li>
                <li>Banking_Dashboard_Data.xlsx workbook</li>
            </ul>

            <h4>Lab Objectives</h4>
            <p>By the end of this lab, you will be able to:</p>
            <ul>
                <li>Add date dimensions for dashboard filtering</li>
                <li>Validate data quality with banking compliance</li>
                <li>Optimize data structure for dashboard performance</li>
                <li>Prepare clean data for data model relationships</li>
            </ul>
        </div>

        <h2>Exercise 1: Add Date Dimensions</h2>

        <div class="step-box">
            <h3><span class="step-number">1</span>Create Date Dimension Table</h3>
            <ol>
                <li>In Power Query Editor, <strong>right-click</strong> on the <strong>Transactions</strong> query</li>
                <li>Select <strong>"Reference"</strong></li>
                <li>Rename the new query to <strong>"Time_Periods"</strong></li>
                <li>Select only the <strong>Date</strong> column</li>
                <li>Right-click → <strong>"Remove Other Columns"</strong></li>
                <li>Go to <strong>Transform</strong> → <strong>Remove Duplicates</strong> (get unique dates only)</li>
            </ol>

            <div class="lab-figure">
                <img src="images/module 3 - excercise 1 - 1.1.png" alt="Reference query" class="lab-image">
                <p class="image-caption">Create reference query from Transactions</p>
            </div>

            <div class="lab-figure">
                <img src="images/module 3 - excercise 1 - 1.2.png" alt="Remove other columns" class="lab-image">
                <p class="image-caption">Keep only Date column</p>
            </div>

            <div class="lab-figure">
                <img src="images/module 3 - excercise 1 - 1.3.png" alt="Remove duplicates" class="lab-image">
                <p class="image-caption">Remove duplicate dates</p>
            </div>
        </div>

        <div class="step-box">
            <h3><span class="step-number">2</span>Add Date Dimension Columns</h3>
            <ol>
                <li>In the Time_Periods query, select the <strong>Date</strong> column</li>
                <li><strong>Add Column</strong> → <strong>Date</strong> → <strong>Year</strong></li>
                <li><strong>Add Column</strong> → <strong>Date</strong> → <strong>Quarter</strong> → <strong>Quarter of
                        Year</strong></li>
                <li><strong>Add Column</strong> → <strong>Date</strong> → <strong>Month</strong> → <strong>Name of
                        Month</strong></li>
                <li>Rename columns:
                    <ul>
                        <li>"Year" → "Calendar_Year"</li>
                        <li>"Quarter" → "Calendar_Quarter"</li>
                        <li>"Month Name" → "Month_Name"</li>
                    </ul>
                </li>
            </ol>

            <div class="lab-figure">
                <img src="images/module 3 - excercise 1 - 2.png" alt="Add date columns" class="lab-image">
                <p class="image-caption">Add Year, Quarter, and Month columns</p>
            </div>
        </div>

        <div class="step-box">
            <h3><span class="step-number">3</span>Create Period Labels</h3>
            <ol>
                <li><strong>Add Column</strong> → <strong>Custom Column</strong></li>
                <li>Column Name: "Period_Label"</li>
                <li>Formula: <code>"Q" & Text.From([Calendar_Quarter]) & " " & Text.From([Calendar_Year])</code></li>
                <li>Add another column: "Year_Month"</li>
                <li>Formula:
                    <code>Text.From([Calendar_Year]) & "-" & Text.PadStart(Text.From(Date.Month([Date])), 2, "0")</code>
                </li>
                <li>Result: "Q1 2024", "2024-01", etc.</li>
            </ol>

            <div class="lab-figure">
                <img src="images/module 3 - excercise 1 - 3.1.png" alt="Period label formula" class="lab-image">
                <p class="image-caption">Create Period_Label custom column</p>
            </div>

            <div class="lab-figure">
                <img src="images/module 3 - excercise 1 - 3.2.png" alt="Period label result" class="lab-image">
                <p class="image-caption">Result with Period_Label and Year_Month columns</p>
            </div>

            <div class="alert alert-info">
                <strong>Why separate Date dimension?</strong> This creates a reusable date table that can be used across
                multiple fact tables and enables proper time-based filtering in the dashboard.
            </div>
        </div>

        <div class="step-box">
            <h3><span class="step-number">4</span>Create Account Hierarchy Dimension</h3>
            <ol>
                <li>In Power Query Editor, go to <strong>Home</strong> → <strong>New Source</strong> →
                    <strong>Text/CSV</strong>
                </li>
                <li>Select <strong>account_hierarchy.csv</strong> from the raw data folder</li>
                <li>Rename query to <strong>"Account_Hierarchy"</strong></li>
                <li>Verify columns: Level_1, Level_2, Level_3, Account_Code</li>
                <li>Change Account_Code data type to <strong>Text</strong></li>
                <li><strong>Add Column</strong> → <strong>Custom Column</strong></li>
                <li>Column Name: <strong>"Account_Code_Standard"</strong></li>
                <li>Formula: <code>Text.PadStart([Account_Code], 6, "0")</code></li>
                <li>This creates 6-digit padded account codes (1110 → 001110) for standardized merging</li>
                <li>This enables account grouping in the dashboard (Assets, Liabilities, Equity)</li>
            </ol>

            <div class="lab-figure">
                <img src="images/module 3 - excercise 1 - 4.png" alt="Account hierarchy" class="lab-image">
                <p class="image-caption">Import and configure Account_Hierarchy dimension</p>
            </div>
        </div>

        <div class="step-box">
            <h3><span class="step-number">5</span>Create Exchange Rates Dimension</h3>
            <ol>
                <li><strong>New Source</strong> → <strong>Text/CSV</strong></li>
                <li>Select <strong>exchange_rates.csv</strong> from the raw data folder</li>
                <li>Click <strong>Transform Data</strong></li>
                <li>Rename query to <strong>"Exchange_Rates"</strong></li>
                <li>Verify columns: <strong>Currency</strong> (Text), <strong>Rate</strong> (Decimal Number)</li>
                <li>Change <strong>Rate</strong> data type to <strong>Decimal Number</strong> if needed</li>
            </ol>

            <div class="lab-figure">
                <img src="images/module 3 - excercise 1 - 5.png" alt="Exchange rates" class="lab-image">
                <p class="image-caption">Import Exchange_Rates dimension table</p>
            </div>

            <div class="alert alert-info">
                <strong>Dashboard Impact:</strong> Exchange rates enable dynamic currency conversion in the dashboard
                (VND ↔ USD ↔ EUR).
            </div>
        </div>

        <h2>Exercise 2: Data Quality Validation</h2>

        <div class="step-box">
            <h3><span class="step-number">1</span>Validate Account Codes</h3>
            <ol>
                <li><strong> In Transactions query, Add Column </strong> → <strong>Custom Column</strong></li>
                <li>Column Name: "Account_Validation"</li>
                <li>Formula:
                    <code>if [Account_Name] = null then "WARNING: Invalid Account Code" else "Valid"</code>
                </li>
                <li>This uses the merge result from Module 2 - null Account_Name means invalid AccountCode</li>
                <li>This flags transactions with invalid account codes</li>
            </ol>

            <div class="lab-figure">
                <img src="images/module 3 - excercise 2 - 1.png" alt="Account validation" class="lab-image">
                <p class="image-caption">Create Account_Validation column</p>
            </div>
        </div>

        <div class="step-box">
            <h3><span class="step-number">2</span>Create Overall Data Quality Flag</h3>
            <ol>
                <li><strong>Add Column</strong> → <strong>Custom Column</strong></li>
                <li>Column Name: "Data_Quality_Status"</li>
                <li>Formula: <code>if [Account_Validation] = "Valid" then "CLEAN" else "REVIEW_REQUIRED"</code></li>
                <li>This provides overall data quality assessment</li>
            </ol>

            <div class="lab-figure">
                <img src="images/module 3 - excercise 2 - 2.png" alt="Data quality flag" class="lab-image">
                <p class="image-caption">Create Data_Quality_Status column</p>
            </div>
        </div>

        <div class="step-box">
            <h3><span class="step-number">3</span>Banking Compliance Check</h3>
            <ol>
                <li><strong>Add Column</strong> → <strong>Custom Column</strong></li>
                <li>Column Name: "Audit_Flag"</li>
                <li>Formula:
                    <code>if [Data_Quality_Status] = "REVIEW_REQUIRED" then "AUDIT: Data Quality Issue - " & [TransactionID] else "OK"</code>
                </li>
                <li>This creates audit trail for compliance</li>
            </ol>

            <div class="lab-figure">
                <img src="images/module 3 - excercise 2 - 3.png" alt="Audit flag" class="lab-image">
                <p class="image-caption">Create Audit_Flag for compliance tracking</p>
            </div>
        </div>

        <h2>Exercise 3: Currency Normalization</h2>

        <div class="step-box">
            <h3><span class="step-number">1</span>Merge Exchange Rates with Transactions</h3>
            <ol>
                <li>In the <strong>Transactions</strong> query, go to <strong>Home</strong> → <strong>Merge
                        Queries</strong></li>
                <li>Select <strong>Currency</strong> column from Transactions</li>
                <li>Select <strong>Exchange_Rates</strong> as the second table</li>
                <li>Select <strong>Currency</strong> column from Exchange_Rates</li>
                <li>Join Kind: <strong>Left Outer</strong> (to keep all transactions)</li>
                <li>Click <strong>OK</strong></li>
            </ol>

            <div class="lab-figure">
                <img src="images/module 3 - excercise 3 - 1.png" alt="Merge exchange rates" class="lab-image">
                <p class="image-caption">Merge Exchange_Rates with Transactions</p>
            </div>
        </div>

        <div class="step-box">
            <h3><span class="step-number">2</span>Expand Exchange Rate Data</h3>
            <ol>
                <li>Click the expand button on the <strong>Exchange_Rates</strong> column</li>
                <li>Select only <strong>Rate</strong> column</li>
                <li>Uncheck "Use original column name as prefix"</li>
                <li>Rename the new column to <strong>"Exchange_Rate"</strong></li>
            </ol>

            <div class="lab-figure">
                <img src="images/module 3 - excercise 3 - 2.png" alt="Expand rate column" class="lab-image">
                <p class="image-caption">Expand Rate column from merged table</p>
            </div>
        </div>

        <div class="step-box">
            <h3><span class="step-number">3</span>Create Amount_VND Column</h3>
            <ol>
                <li><strong>Add Column</strong> → <strong>Custom Column</strong></li>
                <li>Column Name: <strong>"Amount_VND"</strong></li>
                <li>Formula: <code>if [Currency] = "VND" then [Amount] else [Amount] * [Exchange_Rate]</code></li>
                <li>This converts USD and EUR amounts to VND using exchange rates</li>
                <li>VND amounts remain unchanged (Rate = 1 for VND)</li>
            </ol>

            <div class="lab-figure">
                <img src="images/module 3 - excercise 3 - 3.png" alt="Amount VND formula" class="lab-image">
                <p class="image-caption">Create Amount_VND column for currency normalization</p>
            </div>

            <div class="alert alert-info">
                <strong>Currency Logic:</strong> All amounts are normalized to VND as the base currency. Dashboard will
                later convert VND to display currency dynamically.
            </div>
        </div>

        <div class="step-box">
            <h3><span class="step-number">4</span>Validate Currency Conversion</h3>
            <ol>
                <li>Add a temporary column to check conversion:</li>
                <li><strong>Add Column</strong> → <strong>Custom Column</strong></li>
                <li>Column Name: <strong>"Conversion_Check"</strong></li>
                <li>Formula: <code>[Currency] & ": " & Text.From([Amount]) & " → " & Text.From([Amount_VND])</code></li>
                <li>Review a few rows to verify conversions look correct</li>
                <li>Delete the <strong>Conversion_Check</strong> column after validation</li>
            </ol>
        </div>

        <h2>Exercise 4: Data Optimization</h2>

        <div class="step-box">
            <h3><span class="step-number">1</span>Select Essential Columns</h3>
            <ol>
                <li>Hold <strong>Ctrl</strong> and select these columns:
                    <ul>
                        <li>TransactionID, Date, Account_Code_Standard, TransactionType</li>
                        <li>Currency, Amount, Branch, CustomerID</li>
                        <li>Data_Quality_Status, Audit_Flag</li>
                    </ul>
                </li>
                <li>Right-click → <strong>Remove Other Columns</strong></li>
            </ol>
        </div>

        <div class="step-box">
            <h3><span class="step-number">2</span>Final Validation</h3>
            <ol>
                <li><strong>Filter Data_Quality_Status</strong> to show both "CLEAN" and "REVIEW_REQUIRED"</li>
                <li>Keep all data for audit trail purposes</li>
                <li><strong>Close & Load</strong> to update the data model</li>
            </ol>

            <div class="lab-figure">
                <img src="images/module 3 - excercise 4 - 2.png" alt="Final validation" class="lab-image">
                <p class="image-caption">Final data validation and Close & Load</p>
            </div>
        </div>

        <div class="deliverables">
            <h3>Lab Deliverables</h3>

            <h4>✅ Time_Periods Query</h4>
            <ul>
                <li>Separate date table referenced from Transactions</li>
                <li>Calendar_Year, Calendar_Quarter, Month_Name columns</li>
                <li>Period_Label (Q1 2024) and Year_Month (2024-01) formats</li>
            </ul>

            <h4>✅ Account_Hierarchy Query</h4>
            <ul>
                <li>Level_1 (Assets, Liabilities, Equity), Level_2, Level_3 groupings</li>
                <li>Account_Code_Standard with 6-digit padding (1110 → 001110)</li>
                <li>Enables proper financial statement categorization</li>
            </ul>

            <h4>✅ Exchange_Rates Query</h4>
            <ul>
                <li>Currency and Rate columns for multi-currency conversion</li>
                <li>Enables USD reporting consistency in dashboard</li>
                <li>Supports VND, EUR, USD transaction processing</li>
            </ul>

            <h4>✅ Enhanced Transactions Query</h4>
            <ul>
                <li>Account_Validation using merge result from Module 2</li>
                <li>Data_Quality_Status for overall assessment</li>
                <li>Amount_VND column with normalized currency amounts</li>
                <li>Exchange_Rate column merged from Exchange_Rates table</li>
                <li>Banking compliance: Invalid codes flagged, not deleted</li>
            </ul>

            <h4>✅ Dashboard-Ready Structure</h4>
            <ul>
                <li>Five tables ready for Module 4 relationships: Transactions, Time_Periods, Account_Hierarchy,
                    Exchange_Rates</li>
                <li>Quality flags enable exception reporting</li>
                <li>Proper dimensional modeling foundation</li>
            </ul>
        </div>

        <h2>Next Steps</h2>
        <p>In Module 4, we will:</p>
        <ul>
            <li>Use this clean, enhanced data in our data model</li>
            <li>Create relationships between tables</li>
            <li>Build calculations using the prepared structure</li>
            <li>Leverage the data model for dashboard creation</li>
        </ul>

        <p>These Power Query skills form the foundation for professional data preparation in banking and finance.</p>

        <div class="nav-buttons">
            <a href="../../module_02_power_query_basics/labs/lab_02_power_query_basics.html" class="nav-button">←
                Previous Lab</a>
            <a href="../../module_04_data_model_dax/labs/lab_04_data_model_dax.html" class="nav-button">Next Lab →</a>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
</body>

</html>